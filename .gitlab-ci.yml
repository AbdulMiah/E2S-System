image: node:latest

stages:
  - build
  # - test

api build:
  stage: build
  # before_script:
  #   - apt-get update -qy
  #   - apt-get install --no-install-recommends -y npm
  #   - npm --version
  #   - cd ui/ 
  #   - pwd
  #   - npm i
  script:
    - cd api/
    - pwd
    # - echo "//${CI_SERVER_HOST}/api/v4/projects/${CI_PROJECT_ID}/packages/npm/:_authToken=${CI_JOB_TOKEN}">.npmrc
    - echo @c2061455:registry=https://git.cardiff.ac.uk/api/v4/packages/npm/ >> .npmrc
    - npm publish --registry=--registry=https://gitlab.com/api/v4/packages/npm/
    # - echo "This is a build job for ui"
    # - npm run build
  only:
    - cicd

# ui unit test:
#   stage: test
#   # before_script:
#   #   - apt-get update -qy
#   #   - apt-get install --no-install-recommends -y npm
#   #   - npm --version
#   #   - cd ui/ 
#   #   - pwd
#   #   - npm i
#   script:
#     - cd ui/ 
#     - pwd
#     - echo "This is a test job for ui"
    # - npm test